apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordpolicies.policies.mirrord.metalbear.co
spec:
  group: policies.mirrord.metalbear.co
  names:
    kind: MirrordPolicy
    plural: mirrordpolicies
    singular: mirrordpolicy
  scope: Namespaced
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordPolicySpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom resource for policies that limit what mirrord features users can use.

              This policy applies only to resources living in the same namespace.
            properties:
              appliesToCopyTargets:
                default: false
                description: |-
                  Whether this policy applies also to sessions using the copy target feature.

                  By default, policies don't apply to copy target sessions.

                  Defaults to `false`.
                type: boolean
              block:
                description: List of features and operations blocked by this policy.
                items:
                  description: Features and operations that can be blocked by `mirrordpolicies` and `mirrordclusterpolicies`.
                  enum:
                  - steal
                  - steal-without-filter
                  - mirror
                  - copy-target-scale-down
                  type: string
                type: array
              env:
                default:
                  exclude: []
                description: Controls how mirrord-operator handles user requests to fetch environment variables from the target.
                properties:
                  exclude:
                    default: []
                    description: |-
                      List of environment variables that should be excluded when using mirrord.

                      These environment variables won't be retrieved from the target even if the user specifies them in their `feature.env.include` mirrord config.

                      Variable names can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character, e.g. `DATABASE_*` will match `DATABASE_URL` and `DATABASE_PORT`.
                    items:
                      type: string
                    type: array
                type: object
              fs:
                default:
                  local: []
                  notFound: []
                  readOnly: []
                description: Overrides fs ops behaviour, granting control over them to the operator policy, instead of the user config.
                properties:
                  local:
                    default: []
                    description: |-
                      Files that cannot be opened at all.

                      Opening the file will be rejected and mirrord will open the file locally instead.
                    items:
                      type: string
                    type: array
                  notFound:
                    default: []
                    description: |-
                      Files that cannot be opened at all.

                      Opening the file is rejected with an IO error.
                    items:
                      type: string
                    type: array
                  readOnly:
                    default: []
                    description: |-
                      Files that cannot be opened for writing.

                      Opening the file for writing is rejected with an IO error.
                    items:
                      type: string
                    type: array
                type: object
              network:
                default:
                  incoming:
                    httpFilter:
                      headerFilter: null
                  outgoing:
                    allow: []
                    block: []
                description: Fine grained control over network features like specifying required HTTP filters and limiting outgoing connections.
                properties:
                  incoming:
                    default:
                      httpFilter:
                        headerFilter: null
                    description: Incoming network operations policy that partialy mimics the mirrord `network.incoming` config.
                    properties:
                      httpFilter:
                        default:
                          headerFilter: null
                        description: Http filter policy that allows to specify requirements for the HTTP filter used in a session.
                        properties:
                          headerFilter:
                            description: |-
                              Require the user's header filter to match this regex, if such filter is provided.

                              This auto enables `steal-without-filter` policy block to require that the user specifies a header filter for the network steal feature.

                              # Composed filters

                              When the user requests an `all_of` HTTP filter, at least one of the nested filters must be a header filter that matches this regex. At least one nested filter is required.

                              When the user requests an `any_of` HTTP filter, all nested header filters must match this regex. At least one nested header filter is required.
                            nullable: true
                            type: string
                        type: object
                    type: object
                  outgoing:
                    default:
                      allow: []
                      block: []
                    description: Outgoing network operations policy that partialy mimics the mirrord `network.outgoing` config.
                    properties:
                      allow:
                        default: []
                        description: List of allowed outgoing connections. If specified, only connections matching these rules will be permitted. Evaluated before `block` rules, so a connection that matches both will be blocked.
                        items:
                          description: A rule describing outgoing network connections (for either allow or block lists).
                          properties:
                            hostname:
                              description: Regex pattern for matching hostnames.
                              nullable: true
                              type: string
                            ipBlock:
                              description: IP-based destination rules.
                              nullable: true
                              properties:
                                cidr:
                                  description: CIDR notation of the IP range (e.g., "10.0.0.0/16").
                                  type: string
                                except:
                                  default: []
                                  description: List of CIDR ranges to exclude from the IP range.
                                  items:
                                    type: string
                                  type: array
                              required:
                              - cidr
                              type: object
                            ports:
                              default: []
                              description: List of ports and protocols this rule applies to. If not specified, the rule applies to all ports.
                              items:
                                description: Port and protocol specification for outgoing connections.
                                properties:
                                  port:
                                    description: Port number.
                                    format: uint16
                                    minimum: 0.0
                                    type: integer
                                  protocol:
                                    description: Network protocol (TCP or UDP).
                                    enum:
                                    - TCP
                                    - UDP
                                    type: string
                                required:
                                - port
                                - protocol
                                type: object
                              type: array
                          type: object
                        type: array
                      block:
                        default: []
                        description: List of blocked outgoing connections. If specified, connections matching these rules will be denied. Evaluated after `allow` rules, so a connection that matches both will be blocked.
                        items:
                          description: A rule describing outgoing network connections (for either allow or block lists).
                          properties:
                            hostname:
                              description: Regex pattern for matching hostnames.
                              nullable: true
                              type: string
                            ipBlock:
                              description: IP-based destination rules.
                              nullable: true
                              properties:
                                cidr:
                                  description: CIDR notation of the IP range (e.g., "10.0.0.0/16").
                                  type: string
                                except:
                                  default: []
                                  description: List of CIDR ranges to exclude from the IP range.
                                  items:
                                    type: string
                                  type: array
                              required:
                              - cidr
                              type: object
                            ports:
                              default: []
                              description: List of ports and protocols this rule applies to. If not specified, the rule applies to all ports.
                              items:
                                description: Port and protocol specification for outgoing connections.
                                properties:
                                  port:
                                    description: Port number.
                                    format: uint16
                                    minimum: 0.0
                                    type: integer
                                  protocol:
                                    description: Network protocol (TCP or UDP).
                                    enum:
                                    - TCP
                                    - UDP
                                    type: string
                                required:
                                - port
                                - protocol
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                type: object
              profileAllowlist:
                description: |-
                  A list of allowed mirrord profiles.

                  If multiple policies apply to a session, user's mirrord profile must be present in all allowlists.

                  Mind that mirrord profiles are only a functional feature. mirrord Operator is not able to enforce that the application running on the user's machine follows the selected profile.

                  This setting should not be used in order to prevent malicious actions.

                  Optional.
                items:
                  type: string
                nullable: true
                type: array
              requireProfile:
                default: false
                description: |-
                  Enforces that the user selects a mirrord profile for their session.

                  Mind that mirrord profiles are only a functional feature. mirrord Operator is not able to enforce that the application running on the user's machine follows the selected profile.

                  This setting should not be used in order to prevent malicious actions.

                  Defaults to `false`.
                type: boolean
              selector:
                description: If specified in a policy, the policy will only apply to targets with labels that match all of the selector's rules.
                nullable: true
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                    items:
                      description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies to.
                          type: string
                        operator:
                          description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                          enum:
                          - In
                          - NotIn
                          - Exists
                          - DoesNotExist
                          type: string
                        values:
                          description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                          items:
                            type: string
                          nullable: true
                          type: array
                      required:
                      - key
                      - operator
                      type: object
                    nullable: true
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                    nullable: true
                    type: object
                type: object
              targetPath:
                description: Specify the targets for which this policy applies, in the pod/my-pod deploy/my-deploy notation. Targets can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character. If not specified, this policy does not depend on the target's path.
                nullable: true
                type: string
            required:
            - block
            type: object
        required:
        - spec
        title: MirrordPolicy
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclusterpolicies.policies.mirrord.metalbear.co
spec:
  group: policies.mirrord.metalbear.co
  names:
    kind: MirrordClusterPolicy
    plural: mirrordclusterpolicies
    singular: mirrordclusterpolicy
  scope: Cluster
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterPolicySpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom cluster-wide resource for policies that limit what mirrord features users can use.

              This policy applies to resources across all namespaces in the cluster.
            properties:
              appliesToCopyTargets:
                default: false
                description: |-
                  Whether this policy applies also to sessions using the copy target feature.

                  By default, policies don't apply to copy target sessions.

                  Defaults to `false`.
                type: boolean
              block:
                description: List of features and operations blocked by this policy.
                items:
                  description: Features and operations that can be blocked by `mirrordpolicies` and `mirrordclusterpolicies`.
                  enum:
                  - steal
                  - steal-without-filter
                  - mirror
                  - copy-target-scale-down
                  type: string
                type: array
              env:
                default:
                  exclude: []
                description: Controls how mirrord-operator handles user requests to fetch environment variables from the target.
                properties:
                  exclude:
                    default: []
                    description: |-
                      List of environment variables that should be excluded when using mirrord.

                      These environment variables won't be retrieved from the target even if the user specifies them in their `feature.env.include` mirrord config.

                      Variable names can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character, e.g. `DATABASE_*` will match `DATABASE_URL` and `DATABASE_PORT`.
                    items:
                      type: string
                    type: array
                type: object
              fs:
                default:
                  local: []
                  notFound: []
                  readOnly: []
                description: Overrides fs ops behaviour, granting control over them to the operator policy, instead of the user config.
                properties:
                  local:
                    default: []
                    description: |-
                      Files that cannot be opened at all.

                      Opening the file will be rejected and mirrord will open the file locally instead.
                    items:
                      type: string
                    type: array
                  notFound:
                    default: []
                    description: |-
                      Files that cannot be opened at all.

                      Opening the file is rejected with an IO error.
                    items:
                      type: string
                    type: array
                  readOnly:
                    default: []
                    description: |-
                      Files that cannot be opened for writing.

                      Opening the file for writing is rejected with an IO error.
                    items:
                      type: string
                    type: array
                type: object
              network:
                default:
                  incoming:
                    httpFilter:
                      headerFilter: null
                  outgoing:
                    allow: []
                    block: []
                description: Fine grained control over network features like specifying required HTTP filters and limiting outgoing connections.
                properties:
                  incoming:
                    default:
                      httpFilter:
                        headerFilter: null
                    description: Incoming network operations policy that partialy mimics the mirrord `network.incoming` config.
                    properties:
                      httpFilter:
                        default:
                          headerFilter: null
                        description: Http filter policy that allows to specify requirements for the HTTP filter used in a session.
                        properties:
                          headerFilter:
                            description: |-
                              Require the user's header filter to match this regex, if such filter is provided.

                              This auto enables `steal-without-filter` policy block to require that the user specifies a header filter for the network steal feature.

                              # Composed filters

                              When the user requests an `all_of` HTTP filter, at least one of the nested filters must be a header filter that matches this regex. At least one nested filter is required.

                              When the user requests an `any_of` HTTP filter, all nested header filters must match this regex. At least one nested header filter is required.
                            nullable: true
                            type: string
                        type: object
                    type: object
                  outgoing:
                    default:
                      allow: []
                      block: []
                    description: Outgoing network operations policy that partialy mimics the mirrord `network.outgoing` config.
                    properties:
                      allow:
                        default: []
                        description: List of allowed outgoing connections. If specified, only connections matching these rules will be permitted. Evaluated before `block` rules, so a connection that matches both will be blocked.
                        items:
                          description: A rule describing outgoing network connections (for either allow or block lists).
                          properties:
                            hostname:
                              description: Regex pattern for matching hostnames.
                              nullable: true
                              type: string
                            ipBlock:
                              description: IP-based destination rules.
                              nullable: true
                              properties:
                                cidr:
                                  description: CIDR notation of the IP range (e.g., "10.0.0.0/16").
                                  type: string
                                except:
                                  default: []
                                  description: List of CIDR ranges to exclude from the IP range.
                                  items:
                                    type: string
                                  type: array
                              required:
                              - cidr
                              type: object
                            ports:
                              default: []
                              description: List of ports and protocols this rule applies to. If not specified, the rule applies to all ports.
                              items:
                                description: Port and protocol specification for outgoing connections.
                                properties:
                                  port:
                                    description: Port number.
                                    format: uint16
                                    minimum: 0.0
                                    type: integer
                                  protocol:
                                    description: Network protocol (TCP or UDP).
                                    enum:
                                    - TCP
                                    - UDP
                                    type: string
                                required:
                                - port
                                - protocol
                                type: object
                              type: array
                          type: object
                        type: array
                      block:
                        default: []
                        description: List of blocked outgoing connections. If specified, connections matching these rules will be denied. Evaluated after `allow` rules, so a connection that matches both will be blocked.
                        items:
                          description: A rule describing outgoing network connections (for either allow or block lists).
                          properties:
                            hostname:
                              description: Regex pattern for matching hostnames.
                              nullable: true
                              type: string
                            ipBlock:
                              description: IP-based destination rules.
                              nullable: true
                              properties:
                                cidr:
                                  description: CIDR notation of the IP range (e.g., "10.0.0.0/16").
                                  type: string
                                except:
                                  default: []
                                  description: List of CIDR ranges to exclude from the IP range.
                                  items:
                                    type: string
                                  type: array
                              required:
                              - cidr
                              type: object
                            ports:
                              default: []
                              description: List of ports and protocols this rule applies to. If not specified, the rule applies to all ports.
                              items:
                                description: Port and protocol specification for outgoing connections.
                                properties:
                                  port:
                                    description: Port number.
                                    format: uint16
                                    minimum: 0.0
                                    type: integer
                                  protocol:
                                    description: Network protocol (TCP or UDP).
                                    enum:
                                    - TCP
                                    - UDP
                                    type: string
                                required:
                                - port
                                - protocol
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                type: object
              profileAllowlist:
                description: |-
                  A list of allowed mirrord profiles.

                  If multiple policies apply to a session, user's mirrord profile must be present in all allowlists.

                  Optional.
                items:
                  type: string
                nullable: true
                type: array
              requireProfile:
                default: false
                description: |-
                  Enforces that the user selects a mirrord profile for their session.

                  Defaults to `false`.
                type: boolean
              selector:
                description: If specified in a policy, the policy will only apply to targets with labels that match all of the selector's rules.
                nullable: true
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                    items:
                      description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies to.
                          type: string
                        operator:
                          description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                          enum:
                          - In
                          - NotIn
                          - Exists
                          - DoesNotExist
                          type: string
                        values:
                          description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                          items:
                            type: string
                          nullable: true
                          type: array
                      required:
                      - key
                      - operator
                      type: object
                    nullable: true
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                    nullable: true
                    type: object
                type: object
              targetPath:
                description: Specify the targets for which this policy applies, in the pod/my-pod deploy/my-deploy notation. Targets can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character. If not specified, this policy does not depend on the target's path.
                nullable: true
                type: string
            required:
            - block
            type: object
        required:
        - spec
        title: MirrordClusterPolicy
        type: object
    served: true
    storage: true
{{ if .Values.operator.sqsSplitting }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordworkloadqueueregistries.queues.mirrord.metalbear.co
spec:
  group: queues.mirrord.metalbear.co
  names:
    kind: MirrordWorkloadQueueRegistry
    plural: mirrordworkloadqueueregistries
    shortNames:
    - qs
    singular: mirrordworkloadqueueregistry
  scope: Namespaced
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordWorkloadQueueRegistrySpec via `CustomResource`
        properties:
          spec:
            description: |-
              Defines a Custom Resource that holds a central configuration for splitting queues for a QueueConsumer (a target workload for which queues should be split).

              This means there should be 1 such resource per queue splitting target.
            properties:
              consumer:
                description: The resource (deployment or Argo rollout) that reads from the queues.
                properties:
                  container:
                    description: If a container is not specified, the workload queue registry will apply to every run that targets any of the workload's containers.
                    nullable: true
                    type: string
                  name:
                    type: string
                  workloadType:
                    description: A workload that is a consumer of a queue that is being split.
                    enum:
                    - Deployment
                    - Rollout
                    type: string
                required:
                - name
                - workloadType
                type: object
              queues:
                additionalProperties:
                  description: The details of a queue that should be split.
                  oneOf:
                  - required:
                    - nameSource
                    - queueType
                  properties:
                    fallbackName:
                      description: 'Fallback queue name, if the source specified in `nameSource` is not present on the target. If the configured source is not present and the fallback is used - the configured source will be used to make the target use the temporary queue. For example, if `nameSource` is `envVar: MEME_QUEUE_NAME`, but `MEME_QUEUE_NAME` is not present in the target, and `IncomingMemeQueue.fifo` was set as a fallback queue name, then the target will be modified to include the environment variable `MEME_QUEUE_NAME`, with the name of the temporary queue as a value. Setting a fallback name only makes sense if the target application indeed uses the defined queue name source to override the source it uses on its absence.'
                      nullable: true
                      type: string
                    nameSource:
                      description: Where the application gets the queue name from. Will be used to read messages from that queue and distribute them to the output queues. When running with mirrord and splitting this queue, applications will get a modified name from that source.
                      oneOf:
                      - required:
                        - envVar
                      - required:
                        - regexPattern
                      properties:
                        envVar:
                          description: |-
                            Name of an environment variable.

                            References a single environment variable that contains the queue name. Only this one queue will be split.
                          type: string
                        regexPattern:
                          description: |-
                            Regex pattern for environment variable name.

                            References multiple environment variables that can contain names of multiple queues. All found queues will be split.
                          type: string
                      type: object
                    namesFromJsonMap:
                      description: If set, the value read from `name_source` or `fallback_name` will be parsed as a JSON map. The values in this map will be used as queue names.
                      nullable: true
                      type: boolean
                    queueType:
                      enum:
                      - SQS
                      type: string
                    sns:
                      description: When this is set, the mirrord SQS splitting operator will try to parse SQS messages as json objects that are created when SQS messages are created from SNS notifications. The filters will then be matched also against the message attributes that are found inside the body of the SQS message, and originate in SNS notification attributes.
                      nullable: true
                      type: boolean
                    tags:
                      additionalProperties:
                        type: string
                      description: These tags will be set for all temporary SQS queues created by mirrord for queues defined in this MirrordWorkloadQueueRegistry, alongside with the original tags of the respective original queue. In case of a collision, the temporary queue will get the value from the tag passed in here.
                      nullable: true
                      type: object
                  type: object
                description: A map of the queues that should be split. The key is used by users to associate filters to the right queues.
                type: object
              workloadRestartTimeout:
                description: |-
                  Timeout for waiting until workload patch takes effect, that is - at least one pod reads from the main temporary queue.

                  Specified in seconds. Defaults to 120s.
                format: uint32
                minimum: 0.0
                nullable: true
                type: integer
            required:
            - consumer
            - queues
            type: object
          status:
            nullable: true
            properties:
              sqsDetails:
                description: Optional even though it's currently the only field, because in the future there will be fields for other queue types.
                nullable: true
                properties:
                  directEnvVars:
                    additionalProperties:
                      type: string
                    description: Names of env vars that contain the queue name directly in the pod template, without config map refs, mapped to their queue id.
                    type: object
                  envUpdates:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    type: object
                  queueNames:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    description: For each queue_id, the actual queue name as retrieved from the target's pod spec or config map, together with the name of its temporary output queue.
                    type: object
                required:
                - directEnvVars
                - envUpdates
                - queueNames
                type: object
            type: object
        required:
        - spec
        title: MirrordWorkloadQueueRegistry
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordsqssessions.queues.mirrord.metalbear.co
spec:
  group: queues.mirrord.metalbear.co
  names:
    kind: MirrordSQSSession
    plural: mirrordsqssessions
    singular: mirrordsqssession
  scope: Namespaced
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordSqsSessionSpec via `CustomResource`
        properties:
          spec:
            description: The operator creates this object when a user runs mirrord against a target that is a queue consumer.
            properties:
              queueConsumer:
                description: The target of this session.
                properties:
                  container:
                    description: If a container is not specified, the workload queue registry will apply to every run that targets any of the workload's containers.
                    nullable: true
                    type: string
                  name:
                    type: string
                  workloadType:
                    description: A workload that is a consumer of a queue that is being split.
                    enum:
                    - Deployment
                    - Rollout
                    type: string
                required:
                - name
                - workloadType
                type: object
              queueFilters:
                additionalProperties:
                  additionalProperties:
                    type: string
                  type: object
                description: For each queue_id, a mapping from attribute name, to attribute value regex. The queue_id for a queue is determined at the queue registry. It is not (necessarily) The name of the queue on AWS.
                type: object
              queueJqFilters:
                additionalProperties:
                  type: string
                description: |-
                  Specify jq programs that will be used to filter messages from queues. For queues with a specified jq program, for every message the jq filter runs on a JSON representation of the SQS `Message` object.

                  If the jq program outputs `true`, that message is considered as matching the filter.
                type: object
              sessionId:
                description: The id of the mirrord exec session, from the operator.
                type: string
              outputQueueNames:
                description: Explicit output queue names for multi-cluster coordination. Maps original queue names to their output queue names.
                type: object
                additionalProperties:
                  type: string
            required:
            - queueConsumer
            - queueFilters
            - sessionId
            type: object
          status:
            nullable: true
            oneOf:
            - required:
              - Starting
            - required:
              - RegisteringFilters
            - required:
              - Ready
            - required:
              - StartError
            - required:
              - CleanupError
            properties:
              CleanupError:
                properties:
                  details:
                    nullable: true
                    properties:
                      envUpdates:
                        additionalProperties:
                          properties:
                            originalName:
                              type: string
                            outputName:
                              type: string
                          required:
                          - originalName
                          - outputName
                          type: object
                        description: Env var name -> old and new queue names.
                        type: object
                      queueNames:
                        additionalProperties:
                          properties:
                            originalName:
                              type: string
                            outputName:
                              type: string
                          required:
                          - originalName
                          - outputName
                          type: object
                        description: Queue ID -> old and new queue names.
                        type: object
                    required:
                    - envUpdates
                    - queueNames
                    type: object
                  error:
                    description: Representation of Sqs errors for the status of SQS session resources.
                    properties:
                      reason:
                        description: Human-readable explanation of what went wrong.
                        type: string
                      statusCode:
                        description: HTTP code for operator response.
                        format: uint16
                        minimum: 0.0
                        type: integer
                    required:
                    - reason
                    - statusCode
                    type: object
                required:
                - error
                type: object
              Ready:
                properties:
                  envUpdates:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    description: Env var name -> old and new queue names.
                    type: object
                  queueNames:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    description: Queue ID -> old and new queue names.
                    type: object
                required:
                - envUpdates
                - queueNames
                type: object
              RegisteringFilters:
                description: SQS operator sets this status before it starts registering filters, so that if anything fails during the registration of filters, we have all the queues we need to delete on cleanup.
                properties:
                  envUpdates:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    description: Env var name -> old and new queue names.
                    type: object
                  queueNames:
                    additionalProperties:
                      properties:
                        originalName:
                          type: string
                        outputName:
                          type: string
                      required:
                      - originalName
                      - outputName
                      type: object
                    description: Queue ID -> old and new queue names.
                    type: object
                required:
                - envUpdates
                - queueNames
                type: object
              StartError:
                description: Representation of Sqs errors for the status of SQS session resources.
                properties:
                  reason:
                    description: Human-readable explanation of what went wrong.
                    type: string
                  statusCode:
                    description: HTTP code for operator response.
                    format: uint16
                    minimum: 0.0
                    type: integer
                required:
                - reason
                - statusCode
                type: object
              Starting:
                properties:
                  start_time_utc:
                    type: string
                required:
                - start_time_utc
                type: object
            type: object
        required:
        - spec
        title: MirrordSqsSession
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{ end }}
{{ if .Values.operator.kafkaSplitting}}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordkafkaclientconfigs.queues.mirrord.metalbear.co
spec:
  group: queues.mirrord.metalbear.co
  names:
    kind: MirrordKafkaClientConfig
    plural: mirrordkafkaclientconfigs
    singular: mirrordkafkaclientconfig
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Name of parent configuration.
      jsonPath: .spec.parent
      name: PARENT
      type: string
    - description: Name of Secret to load from.
      jsonPath: .spec.loadFromSecret
      name: SECRET
      type: string
    - description: Additional authentication config.
      jsonPath: .spec.authenticationExtra
      name: AUTHENTICATION_EXTRA
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordKafkaClientConfigSpec via `CustomResource`
        properties:
          spec:
            description: Configuration to use when creating operator's Kafka client. Resources of this kind should live in the operator's namespace.
            properties:
              authenticationExtra:
                description: Additional authentication configuration.
                nullable: true
                properties:
                  awsRegion:
                    description: |-
                      AWS region of the MSK cluster.

                      Required when `kind` is `MSK_IAM`.
                    nullable: true
                    type: string
                  kind:
                    description: |-
                      Authentication kind.

                      Right now the only supported value is `MSK_IAM`, which enables IAM/OAUTHBEARER authentication with Amazon Managed Streaming for Apache Kafka.

                      When this is set to `MSK_IAM`, additional properties are merged into the configuration: 1. `sasl.mechanism=OAUTHBEARER` 2. `security.protocol=SASL_SSL`
                    type: string
                required:
                - kind
                type: object
              loadFromSecret:
                description: |-
                  Namespace and name of a `Secret` to use as another source of properties.

                  The secret is fetched and entries in its `.data` field are resolved to properties. Properties resolved this way override properties from the parent configuration. Properties defined inline in this object override properties resolved from the secret.

                  Example value: `default/my-secret`
                nullable: true
                type: string
              parent:
                description: Name of parent resource to use as base when resolving final configuration.
                nullable: true
                type: string
              properties:
                description: |-
                  Properties to set.

                  When performing Kafka splitting, the operator will override `group.id` property.

                  The list of all available properties can be found [here](https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md).
                items:
                  description: Property to use when creating operator's Kafka client.
                  properties:
                    name:
                      description: Name of the property, e.g `bootstrap.servers`.
                      type: string
                    value:
                      description: Value for the property, e.g `kafka.default.svc.cluster.local:9092`. `null` clears the property from parent resource when resolving the final configuration.
                      nullable: true
                      type: string
                  required:
                  - name
                  type: object
                type: array
            required:
            - properties
            type: object
        required:
        - spec
        title: MirrordKafkaClientConfig
        type: object
    served: true
    storage: true
    subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordkafkaephemeraltopics.queues.mirrord.metalbear.co
spec:
  group: queues.mirrord.metalbear.co
  names:
    kind: MirrordKafkaEphemeralTopic
    plural: mirrordkafkaephemeraltopics
    singular: mirrordkafkaephemeraltopic
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Name of the topic.
      jsonPath: .spec.name
      name: NAME
      type: string
    - description: Name of MirrordKafkaClientProperties to use when creating Kafka client.
      jsonPath: .spec.clientConfig
      name: CLIENT-CONFIG
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordKafkaEphemeralTopicSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Ephemeral topic created in your Kafka cluster for the purpose of running a Kafka splitting session.

              Resources of this kind should live in the operator's namespace. They will be used to clean up topics that are no longer used.
            properties:
              clientConfig:
                description: Links to [`MirrordKafkaClientConfigSpec`] resource living in the same namespace.
                type: string
              name:
                description: Name of the topic.
                type: string
            required:
            - clientConfig
            - name
            type: object
        required:
        - spec
        title: MirrordKafkaEphemeralTopic
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordkafkatopicsconsumers.queues.mirrord.metalbear.co
spec:
  group: queues.mirrord.metalbear.co
  names:
    kind: MirrordKafkaTopicsConsumer
    plural: mirrordkafkatopicsconsumers
    singular: mirrordkafkatopicsconsumer
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Name of the topic consumer workload.
      jsonPath: .spec.consumerName
      name: CONSUMER-NAME
      type: string
    - description: Kind of the topic consumer workload.
      jsonPath: .spec.consumerKind
      name: CONSUMER-KIND
      type: string
    - description: Api version of the topic consumer workload.
      jsonPath: .spec.consumerApiVersion
      name: CONSUMER-API-VERSION
      type: string
    - description: Timeout for consumer workload restart.
      jsonPath: .spec.consumerRestartTimeout
      name: CONSUMER-RESTART-TIMEOUT
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordKafkaTopicsConsumerSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Defines splittable Kafka topics consumed by some workload living in the same namespace.

              # Concurrent splitting

              Concurrent Kafka splitting sessions are allowed, as long as they use the same topic id or their topics' `nameSources` do not overlap.

              # Example

              ```yaml apiVersion: queues.mirrord.metalbear.co/v1alpha kind: MirrordKafkaTopicsConsumer metadata: name: example namespace: default spec: consumerName: example-deployment consumerApiVersion: apps/v1 consumerKind: Deployment topics: - id: example-topic nameSources: - directEnvVar: container: example-container name: KAFKA_TOPIC_NAME groupIdSources: - directEnvVar: container: example-container name: KAFKA_GROUP_ID clientConfig: example-config ```

              1. Creating the resource below will enable Kafka splitting on a deployment `example-deployment` living in namespace `default`. Id `example-topic` can be then used in the mirrord config to split the topic for the duration of the mirrord session.

              2. Topic name will be resolved based on `example-deployment`'s pod template by extracting value of variable `KAFKA_TOPIC_NAME` defined directly in `example-container`.

              3. Consumer group id used by the mirrord operator will be resolved based on `example-deployment`'s pod template by extracting value of variable `KAFKA_GROUP_ID` defined directly in `example-container`.

              4. For the duration of the session, `example-deployment` will be patched - the mirrord operator will substitute topic name in `KAFKA_TOPIC_NAME` variable with a name of an ephemeral Kafka topic.

              5. Local application will see a different value of the `KAFKA_TOPIC_NAME` - it will be a name of another ephemeral Kafka topic.

              6. `MirrordKafkaClientConfig` named `example-config` living in mirrord operator's namespace will be used to manage ephemeral Kafka topics and consume/produce messages.
            properties:
              consumerApiVersion:
                description: Workload api version, for example `apps/v1`.
                type: string
              consumerKind:
                description: Workload kind, for example `Deployment`.
                type: string
              consumerName:
                description: Workload name, for example `my-deployment`.
                type: string
              consumerRestartTimeout:
                description: |-
                  Timeout for waiting until workload patch takes effect, that is at least one pod reads from the ephemeral topic.

                  Specified in seconds. Defaults to 60s.
                format: uint32
                minimum: 0.0
                nullable: true
                type: integer
              splitTtl:
                description: |-
                  Period of time to wait before cleaning up Kafka splits for this consumer and reverting Pod template patches (in seconds).

                  For any given topic, starting the first Kafka splitting session requires patching the target workload. Similarly, stopping the last Kafka splitting session requires another patch, that reverts the first one.

                  If the target workload takes a long time to restart, it may be desirable to keep the Kafka splits alive longer, so that the next Kafka splitting session will not have to patch the workload again.
                format: uint32
                minimum: 0.0
                nullable: true
                type: integer
              topics:
                description: List of consumed splittable topics.
                items:
                  description: Splittable Kafka topic consumed by some remote target.
                  properties:
                    clientConfig:
                      description: Links to [`MirrordKafkaClientConfig`] in the operator's namespace. This config will be used to manage ephemeral Kafka topics and consume/produce messages.
                      type: string
                    groupIdSources:
                      description: All occurrences of this topic's group id in the workload's pod template.
                      items:
                        description: Source of some topic property required for Kafka splitting.
                        oneOf:
                        - required:
                          - directEnvVar
                        properties:
                          directEnvVar:
                            description: Environment variable with value defined directly in the pod template.
                            properties:
                              container:
                                description: Name of the container.
                                type: string
                              variable:
                                description: Name of the variable.
                                type: string
                            required:
                            - container
                            - variable
                            type: object
                        type: object
                      type: array
                    id:
                      description: Id of this topic. Can be used in mirrord config to identify this topic.
                      type: string
                    nameSources:
                      description: All occurrences of this topic's name in the workload's pod template.
                      items:
                        description: Source of some topic property required for Kafka splitting.
                        oneOf:
                        - required:
                          - directEnvVar
                        properties:
                          directEnvVar:
                            description: Environment variable with value defined directly in the pod template.
                            properties:
                              container:
                                description: Name of the container.
                                type: string
                              variable:
                                description: Name of the variable.
                                type: string
                            required:
                            - container
                            - variable
                            type: object
                        type: object
                      type: array
                  required:
                  - clientConfig
                  - groupIdSources
                  - id
                  - nameSources
                  type: object
                type: array
            required:
            - consumerApiVersion
            - consumerKind
            - consumerName
            - topics
            type: object
        required:
        - spec
        title: MirrordKafkaTopicsConsumer
        type: object
    served: true
    storage: true
{{ end }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordtlsstealconfigs.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordTlsStealConfig
    plural: mirrordtlsstealconfigs
    singular: mirrordtlsstealconfig
  scope: Namespaced
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordTlsStealConfigSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom resource for configuring how the mirrord-agent handles stealing TLS traffic from selected targets.

              Namespaced.
            properties:
              ports:
                description: Configuration for stealing TLS traffic, separate for each port.
                items:
                  description: Configures TLS setup for stealing traffic from some port.
                  properties:
                    agentAsClient:
                      description: |-
                        Configures how mirrord-agent authenticates itself and the server when acting as a TLS client.

                        mirrord-agent acts as a TLS client when passing unmatched requests to their original destination.
                      properties:
                        authentication:
                          description: |-
                            Configures how mirrord-agent authenticates itself to the original destination server.

                            Optional. If not present, mirrord-agent will make connections anonymously.
                          nullable: true
                          properties:
                            certPem:
                              description: |-
                                Path to a PEM file containing a certificate chain to use.

                                This file must contain at least one certificate. It can contain entries of other types, e.g private keys, which are ignored.
                              type: string
                            keyPem:
                              description: |-
                                Path to a PEM file containing a private key matching the certificate chain found in `cert_pem`.

                                This file must contain exactly one private key. It can contain entries of other types, e.g certificates, which are ignored.
                              type: string
                          required:
                          - certPem
                          - keyPem
                          type: object
                        verification:
                          description: Configures how mirrord-agent verifies the server's certificate.
                          properties:
                            acceptAnyCert:
                              description: |-
                                Whether to accept any certificate, regardless of its validity and who signed it.

                                Optional. Defaults to `false`.
                              type: boolean
                            trustRoots:
                              description: |-
                                Paths to PEM files and directories with PEM files containing allowed root certificates.

                                Directories are not traversed recursively.

                                Each certificate found in the files is treated as an allowed root. The files can contain entries of other types, e.g private keys, which are ignored.

                                Optional. Defaults to an empty list.
                              items:
                                type: string
                              type: array
                          type: object
                      required:
                      - verification
                      type: object
                    agentAsServer:
                      description: |-
                        Configures how mirrord-agent authenticates itself and the clients when acting as a TLS server.

                        mirrord-agent acts as a TLS server when accepting stolen connections.
                      properties:
                        alpnProtocols:
                          description: |-
                            ALPN protocols supported by the server, in order of preference.

                            If empty, ALPN is disabled.

                            Optional. Defaults to en ampty list.
                          items:
                            type: string
                          type: array
                        authentication:
                          description: Configures how the server authenticates itself to the clients.
                          properties:
                            certPem:
                              description: |-
                                Path to a PEM file containing a certificate chain to use.

                                This file must contain at least one certificate. It can contain entries of other types, e.g private keys, which are ignored.
                              type: string
                            keyPem:
                              description: |-
                                Path to a PEM file containing a private key matching the certificate chain found in `cert_pem`.

                                This file must contain exactly one private key. It can contain entries of other types, e.g certificates, which are ignored.
                              type: string
                          required:
                          - certPem
                          - keyPem
                          type: object
                        verification:
                          description: |-
                            Configures how mirrord-agent's server verifies the clients.

                            Optional. If not present, the server will not offer client authentication at all.
                          nullable: true
                          properties:
                            acceptAnyCert:
                              description: |-
                                Whether to accept any certificate, regardless of its validity and who signed it.

                                Note that this setting does not affect whether anononymous clients are accepted or not. If `allow_anonymous` is not set, a certificate will still be required.

                                Optional. Defaults to `false`.
                              type: boolean
                            allowAnonymous:
                              description: |-
                                Whether anonymous clients should be accepted.

                                Optional. Defaults to `false`.
                              type: boolean
                            trustRoots:
                              description: |-
                                Paths to PEM files and directories with PEM files containing allowed root certificates.

                                Directories are not traversed recursively.

                                Each certificate found in the files is treated as an allowed root. The files can contain entries of other types, e.g private keys, which are ignored.

                                Optional. Defaults to an empty list.
                              items:
                                type: string
                              type: array
                          type: object
                      required:
                      - authentication
                      type: object
                    port:
                      description: Remote port to which this configuration applies.
                      format: uint16
                      minimum: 0.0
                      type: integer
                  required:
                  - agentAsClient
                  - agentAsServer
                  - port
                  type: object
                type: array
              selector:
                description: If this selector is provided, this configuration will only apply to targets with labels that match all of the selector's rules.
                nullable: true
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                    items:
                      description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies to.
                          type: string
                        operator:
                          description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                          enum:
                          - In
                          - NotIn
                          - Exists
                          - DoesNotExist
                          type: string
                        values:
                          description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                          items:
                            type: string
                          nullable: true
                          type: array
                      required:
                      - key
                      - operator
                      type: object
                    nullable: true
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                    nullable: true
                    type: object
                type: object
              targetPath:
                description: |-
                  Specify the targets for which this configuration applies, in the `pod/my-pod`, `deploy/my-deploy/container/my-container` notation.

                  Targets can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character. If not specified, this configuration does not depend on the target's path.
                nullable: true
                type: string
            required:
            - ports
            type: object
        required:
        - spec
        title: MirrordTlsStealConfig
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclustertlsstealconfigs.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordClusterTlsStealConfig
    plural: mirrordclustertlsstealconfigs
    singular: mirrordclustertlsstealconfig
  scope: Cluster
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterTlsStealConfigSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom resource for configuring how the mirrord-agent handles stealing TLS traffic from selected targets.

              Clusterwide.
            properties:
              ports:
                description: Configuration for stealing TLS traffic, separate for each port.
                items:
                  description: Configures TLS setup for stealing traffic from some port.
                  properties:
                    agentAsClient:
                      description: |-
                        Configures how mirrord-agent authenticates itself and the server when acting as a TLS client.

                        mirrord-agent acts as a TLS client when passing unmatched requests to their original destination.
                      properties:
                        authentication:
                          description: |-
                            Configures how mirrord-agent authenticates itself to the original destination server.

                            Optional. If not present, mirrord-agent will make connections anonymously.
                          nullable: true
                          properties:
                            certPem:
                              description: |-
                                Path to a PEM file containing a certificate chain to use.

                                This file must contain at least one certificate. It can contain entries of other types, e.g private keys, which are ignored.
                              type: string
                            keyPem:
                              description: |-
                                Path to a PEM file containing a private key matching the certificate chain found in `cert_pem`.

                                This file must contain exactly one private key. It can contain entries of other types, e.g certificates, which are ignored.
                              type: string
                          required:
                          - certPem
                          - keyPem
                          type: object
                        verification:
                          description: Configures how mirrord-agent verifies the server's certificate.
                          properties:
                            acceptAnyCert:
                              description: |-
                                Whether to accept any certificate, regardless of its validity and who signed it.

                                Optional. Defaults to `false`.
                              type: boolean
                            trustRoots:
                              description: |-
                                Paths to PEM files and directories with PEM files containing allowed root certificates.

                                Directories are not traversed recursively.

                                Each certificate found in the files is treated as an allowed root. The files can contain entries of other types, e.g private keys, which are ignored.

                                Optional. Defaults to an empty list.
                              items:
                                type: string
                              type: array
                          type: object
                      required:
                      - verification
                      type: object
                    agentAsServer:
                      description: |-
                        Configures how mirrord-agent authenticates itself and the clients when acting as a TLS server.

                        mirrord-agent acts as a TLS server when accepting stolen connections.
                      properties:
                        alpnProtocols:
                          description: |-
                            ALPN protocols supported by the server, in order of preference.

                            If empty, ALPN is disabled.

                            Optional. Defaults to en ampty list.
                          items:
                            type: string
                          type: array
                        authentication:
                          description: Configures how the server authenticates itself to the clients.
                          properties:
                            certPem:
                              description: |-
                                Path to a PEM file containing a certificate chain to use.

                                This file must contain at least one certificate. It can contain entries of other types, e.g private keys, which are ignored.
                              type: string
                            keyPem:
                              description: |-
                                Path to a PEM file containing a private key matching the certificate chain found in `cert_pem`.

                                This file must contain exactly one private key. It can contain entries of other types, e.g certificates, which are ignored.
                              type: string
                          required:
                          - certPem
                          - keyPem
                          type: object
                        verification:
                          description: |-
                            Configures how mirrord-agent's server verifies the clients.

                            Optional. If not present, the server will not offer client authentication at all.
                          nullable: true
                          properties:
                            acceptAnyCert:
                              description: |-
                                Whether to accept any certificate, regardless of its validity and who signed it.

                                Note that this setting does not affect whether anononymous clients are accepted or not. If `allow_anonymous` is not set, a certificate will still be required.

                                Optional. Defaults to `false`.
                              type: boolean
                            allowAnonymous:
                              description: |-
                                Whether anonymous clients should be accepted.

                                Optional. Defaults to `false`.
                              type: boolean
                            trustRoots:
                              description: |-
                                Paths to PEM files and directories with PEM files containing allowed root certificates.

                                Directories are not traversed recursively.

                                Each certificate found in the files is treated as an allowed root. The files can contain entries of other types, e.g private keys, which are ignored.

                                Optional. Defaults to an empty list.
                              items:
                                type: string
                              type: array
                          type: object
                      required:
                      - authentication
                      type: object
                    port:
                      description: Remote port to which this configuration applies.
                      format: uint16
                      minimum: 0.0
                      type: integer
                  required:
                  - agentAsClient
                  - agentAsServer
                  - port
                  type: object
                type: array
              selector:
                description: If this selector is provided, this configuration will only apply to targets with labels that match all of the selector's rules.
                nullable: true
                properties:
                  matchExpressions:
                    description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                    items:
                      description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies to.
                          type: string
                        operator:
                          description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                          enum:
                          - In
                          - NotIn
                          - Exists
                          - DoesNotExist
                          type: string
                        values:
                          description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                          items:
                            type: string
                          nullable: true
                          type: array
                      required:
                      - key
                      - operator
                      type: object
                    nullable: true
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                    nullable: true
                    type: object
                type: object
              targetPath:
                description: |-
                  Specify the targets for which this configuration applies, in the `pod/my-pod`, `deploy/my-deploy/container/my-container` notation.

                  Targets can be matched using `*` and `?` where `?` matches exactly one occurrence of any character and `*` matches arbitrary many (including zero) occurrences of any character. If not specified, this configuration does not depend on the target's path.
                nullable: true
                type: string
            required:
            - ports
            type: object
        required:
        - spec
        title: MirrordClusterTlsStealConfig
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordprofiles.profiles.mirrord.metalbear.co
spec:
  group: profiles.mirrord.metalbear.co
  names:
    kind: MirrordProfile
    plural: mirrordprofiles
    singular: mirrordprofile
  scope: Namespaced
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordProfileSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom namespaced resource for storing a reusable mirrord config template.

              Can be selected from the user's mirrord config.

              Examle: ```json { "profile": "my-namespace/my-profile" } ```
            properties:
              featureAdjustments:
                description: |-
                  A list of adjustments to be made in the user's feature config.

                  The adjustments are applied in order.
                items:
                  description: A single adjustment to the mirrord config's `feature` section.
                  properties:
                    change:
                      description: The change to be made in the user's config.
                      enum:
                      - incoming-mirror
                      - incoming-steal
                      - incoming-off
                      - dns-remote
                      - dns-off
                      - outgoing-remote
                      - outgoing-off
                      type: string
                  required:
                  - change
                  type: object
                type: array
            required:
            - featureAdjustments
            type: object
        required:
        - spec
        title: MirrordProfile
        type: object
    served: true
    storage: true
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclusterprofiles.profiles.mirrord.metalbear.co
spec:
  group: profiles.mirrord.metalbear.co
  names:
    kind: MirrordClusterProfile
    plural: mirrordclusterprofiles
    singular: mirrordclusterprofile
  scope: Cluster
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterProfileSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Custom cluster-wide resource for storing a reusable mirrord config template.

              Can be selected from the user's mirrord config.

              Mind that mirrord profiles are only a functional feature. mirrord Operator is not able to enforce that the application running on the user's machine follows the selected profile.

              This feature should not be used in order to prevent malicious actions.
            properties:
              featureAdjustments:
                description: |-
                  A list of adjustments to be made in the user's feature config.

                  The adjustments are applied in order.
                items:
                  description: A single adjustment to the mirrord config's `feature` section.
                  properties:
                    change:
                      description: The change to be made in the user's config.
                      enum:
                      - incoming-mirror
                      - incoming-steal
                      - incoming-off
                      - dns-remote
                      - dns-off
                      - outgoing-remote
                      - outgoing-off
                      type: string
                  required:
                  - change
                  type: object
                type: array
            required:
            - featureAdjustments
            type: object
        required:
        - spec
        title: MirrordClusterProfile
        type: object
    served: true
    storage: true
{{ if .Values.operator.mysqlBranching }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mysqlbranchdatabases.dbs.mirrord.metalbear.co
spec:
  group: dbs.mirrord.metalbear.co
  names:
    kind: MysqlBranchDatabase
    plural: mysqlbranchdatabases
    singular: mysqlbranchdatabase
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MysqlBranchDatabaseSpec via `CustomResource`
        properties:
          spec:
            properties:
              connectionSource:
                description: Database connection info from the workload.
                oneOf:
                - required:
                  - url
                - required:
                  - params
                properties:
                  url:
                    description: A complete connection URL.
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  params:
                    description: Individual connection parameters (host, port, user, password, database).
                    properties:
                      host:
                        description: Host parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      port:
                        description: Port parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      user:
                        description: User parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      password:
                        description: Password parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      database:
                        description: Database name parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                    type: object
                type: object
              copy:
                default:
                  mode: empty
                description: Options for copying data from source database to the branch.
                properties:
                  mode:
                    description: The default copy mode for the branch.
                    enum:
                    - empty
                    - schema
                    - all
                    type: string
                  tables:
                    additionalProperties:
                      properties:
                        filter:
                          description: Data that matches the filter will be copied. For MySQL, this filter is a `where` clause that looks like `username = 'alice'`.
                          nullable: true
                          type: string
                      type: object
                    description: An optional list of tables whose schema and data will be copied based on their table level copy config. Only compatible with `Empty` and `Schema` copy mode.
                    nullable: true
                    type: object
                required:
                - mode
                type: object
              databaseName:
                description: MySQL database name.
                nullable: true
                type: string
              id:
                description: ID derived by mirrord CLI.
                type: string
              mysqlVersion:
                description: MySQL server image version, e.g. "8.0".
                nullable: true
                type: string
              target:
                description: Target k8s resource to extract connection source info from.
                oneOf:
                - required:
                  - deployment
                - required:
                  - pod
                - required:
                  - rollout
                - required:
                  - job
                - required:
                  - cron_job
                - required:
                  - stateful_set
                - required:
                  - service
                - required:
                  - replica_set
                properties:
                  container:
                    nullable: true
                    type: string
                  cron_job:
                    type: string
                  deployment:
                    description: <!--${internal}--> Deployment to mirror.
                    type: string
                  job:
                    type: string
                  pod:
                    description: <!--${internal}--> Pod to mirror.
                    type: string
                  replica_set:
                    type: string
                  rollout:
                    description: <!--${internal}--> Rollout to mirror.
                    type: string
                  service:
                    type: string
                  stateful_set:
                    type: string
                type: object
              ttlSecs:
                description: The duration in seconds this branch database will live idling.
                format: uint64
                minimum: 0.0
                type: integer
            required:
            - connectionSource
            - id
            - target
            - ttlSecs
            type: object
          status:
            nullable: true
            properties:
              error:
                description: Error message if the branch database failed to create.
                nullable: true
                type: string
              expireTime:
                description: Time when the branch database should be deleted.
                format: date-time
                type: string
              phase:
                enum:
                - Pending
                - Ready
                - Failed
                type: string
              sessionInfo:
                additionalProperties:
                  properties:
                    id:
                      description: Session id.
                      type: string
                    owner:
                      description: Owner info of the session.
                      properties:
                        hostname:
                          description: Creator hostname.
                          type: string
                        k8sUsername:
                          description: Creator Kubernetes username.
                          type: string
                        userId:
                          description: Unique ID.
                          type: string
                        username:
                          description: Creator local username.
                          type: string
                      required:
                      - hostname
                      - k8sUsername
                      - userId
                      - username
                      type: object
                  required:
                  - id
                  - owner
                  type: object
                default: {}
                description: Information of sessions that are using this branch database.
                type: object
            required:
            - expireTime
            - phase
            type: object
        required:
        - spec
        title: MysqlBranchDatabase
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{ end }}
---
{{ if .Values.operator.pgBranching }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: pgbranchdatabases.dbs.mirrord.metalbear.co
spec:
  group: dbs.mirrord.metalbear.co
  names:
    kind: PgBranchDatabase
    plural: pgbranchdatabases
    singular: pgbranchdatabase
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for PgBranchDatabaseSpec via `CustomResource`
        properties:
          spec:
            properties:
              connectionSource:
                description: Database connection info from the workload.
                oneOf:
                - required:
                  - url
                - required:
                  - params
                properties:
                  url:
                    description: A complete connection URL.
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  params:
                    description: Individual connection parameters (host, port, user, password, database).
                    properties:
                      host:
                        description: Host parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      port:
                        description: Port parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      user:
                        description: User parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      password:
                        description: Password parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      database:
                        description: Database name parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                    type: object
                type: object
              copy:
                default:
                  mode: empty
                description: Options for copying data from source database to the branch.
                properties:
                  mode:
                    description: The default copy mode for the branch.
                    enum:
                    - empty
                    - schema
                    - all
                    type: string
                  tables:
                    additionalProperties:
                      properties:
                        filter:
                          description: Data that matches the filter will be copied. For PostgreSQL, this filter is a `where` clause that looks like `username = 'alice'`.
                          nullable: true
                          type: string
                      type: object
                    description: An optional list of tables whose schema and data will be copied based on their table level copy config. Only compatible with `Empty` and `Schema` copy mode.
                    nullable: true
                    type: object
                required:
                - mode
                type: object
              databaseName:
                description: PostgreSQL database name.
                nullable: true
                type: string
              iamAuth:
                description: IAM authentication configuration for the source database. Use this when the source database (RDS, Cloud SQL) requires IAM auth instead of passwords.
                nullable: true
                oneOf:
                - required:
                  - type
                properties:
                  type:
                    description: Type of IAM authentication.
                    enum:
                    - aws_rds
                    - gcp_cloud_sql
                    type: string
                  region:
                    description: AWS region source (only for aws_rds type). If not specified, uses AWS_REGION or AWS_DEFAULT_REGION.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  access_key_id:
                    description: AWS Access Key ID source (only for aws_rds type). If not specified, uses AWS_ACCESS_KEY_ID.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  secret_access_key:
                    description: AWS Secret Access Key source (only for aws_rds type). If not specified, uses AWS_SECRET_ACCESS_KEY.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  session_token:
                    description: AWS Session Token source (only for aws_rds type). If not specified, uses AWS_SESSION_TOKEN.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  credentials_json:
                    description: Inline GCP service account JSON credentials (only for gcp_cloud_sql type). Pass credentials directly from an env var instead of mounting a file.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  credentials_path:
                    description: Path to GCP service account JSON key file (only for gcp_cloud_sql type). The file must be accessible from the init container.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  project:
                    description: GCP project ID source (only for gcp_cloud_sql type). If not specified, uses GOOGLE_CLOUD_PROJECT.
                    nullable: true
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                type: object
              id:
                description: ID derived by mirrord CLI.
                type: string
              postgresVersion:
                description: PostgreSQL server image version, e.g. "17".
                nullable: true
                type: string
              target:
                description: Target k8s resource to extract connection source info from.
                oneOf:
                - required:
                  - deployment
                - required:
                  - pod
                - required:
                  - rollout
                - required:
                  - job
                - required:
                  - cron_job
                - required:
                  - stateful_set
                - required:
                  - service
                - required:
                  - replica_set
                properties:
                  container:
                    nullable: true
                    type: string
                  cron_job:
                    type: string
                  deployment:
                    description: <!--${internal}--> Deployment to mirror.
                    type: string
                  job:
                    type: string
                  pod:
                    description: <!--${internal}--> Pod to mirror.
                    type: string
                  replica_set:
                    type: string
                  rollout:
                    description: <!--${internal}--> Rollout to mirror.
                    type: string
                  service:
                    type: string
                  stateful_set:
                    type: string
                type: object
              ttlSecs:
                description: The duration in seconds this branch database will live idling.
                format: uint64
                minimum: 0.0
                type: integer
            required:
            - connectionSource
            - id
            - target
            - ttlSecs
            type: object
          status:
            nullable: true
            properties:
              error:
                description: Error message if the branch database failed to create.
                nullable: true
                type: string
              expireTime:
                description: Time when the branch database should be deleted.
                format: date-time
                type: string
              phase:
                enum:
                - Pending
                - Ready
                - Failed
                type: string
              sessionInfo:
                additionalProperties:
                  properties:
                    id:
                      description: Session id.
                      type: string
                    owner:
                      description: Owner info of the session.
                      properties:
                        hostname:
                          description: Creator hostname.
                          type: string
                        k8sUsername:
                          description: Creator Kubernetes username.
                          type: string
                        userId:
                          description: Unique ID.
                          type: string
                        username:
                          description: Creator local username.
                          type: string
                      required:
                      - hostname
                      - k8sUsername
                      - userId
                      - username
                      type: object
                  required:
                  - id
                  - owner
                  type: object
                default: {}
                description: Information of sessions that are using this branch database.
                type: object
            required:
            - expireTime
            - phase
            type: object
        required:
        - spec
        title: PgBranchDatabase
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{ end }}
---
{{ if .Values.operator.mongodbBranching }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mongodbbranchdatabases.dbs.mirrord.metalbear.co
spec:
  group: dbs.mirrord.metalbear.co
  names:
    kind: MongodbBranchDatabase
    plural: mongodbbranchdatabases
    singular: mongodbbranchdatabase
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MongodbBranchDatabaseSpec via `CustomResource`
        properties:
          spec:
            properties:
              connectionSource:
                description: Database connection info from the workload.
                oneOf:
                - required:
                  - url
                - required:
                  - params
                properties:
                  url:
                    description: A complete connection URL.
                    oneOf:
                    - required:
                      - env
                    - required:
                      - envFrom
                    - required:
                      - secret
                    properties:
                      env:
                        description: Environment variable with value defined directly in the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      envFrom:
                        description: Environment from resource reference in the the pod template.
                        properties:
                          container:
                            nullable: true
                            type: string
                          variable:
                            type: string
                        required:
                        - variable
                        type: object
                      secret:
                        description: Value read directly from a Kubernetes Secret.
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  params:
                    description: Individual connection parameters (host, port, user, password, database).
                    properties:
                      host:
                        description: Host parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      port:
                        description: Port parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      user:
                        description: User parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      password:
                        description: Password parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                      database:
                        description: Database name parameter.
                        oneOf:
                        - required:
                          - env
                        - required:
                          - envFrom
                        - required:
                          - secret
                        properties:
                          env:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          envFrom:
                            properties:
                              container:
                                nullable: true
                                type: string
                              variable:
                                type: string
                            required:
                            - variable
                            type: object
                          secret:
                            description: Value read directly from a Kubernetes Secret.
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                            required:
                            - key
                            - name
                            type: object
                        type: object
                    type: object
                type: object
              copy:
                default:
                  mode: empty
                description: Options for copying data from source database to the branch.
                properties:
                  collections:
                    additionalProperties:
                      properties:
                        filter:
                          description: 'Data that matches the filter will be copied. For MongoDB, this filter is a JSON query document like {"age": {"$gte": 18}}.'
                          nullable: true
                          type: string
                      type: object
                    description: An optional map of collection names to their copy configurations. When specified, only these collections will be copied with their respective filters.
                    nullable: true
                    type: object
                  mode:
                    description: The copy mode for the branch. 'empty' creates an empty database, 'all' copies all collections with data.
                    enum:
                    - empty
                    - all
                    type: string
                required:
                - mode
                type: object
              databaseName:
                description: MongoDB database name.
                nullable: true
                type: string
              id:
                description: ID derived by mirrord CLI.
                type: string
              mongodbVersion:
                description: MongoDB server image version, e.g. "7.0".
                nullable: true
                type: string
              target:
                description: Target k8s resource to extract connection source info from.
                oneOf:
                - required:
                  - deployment
                - required:
                  - pod
                - required:
                  - rollout
                - required:
                  - job
                - required:
                  - cron_job
                - required:
                  - stateful_set
                - required:
                  - service
                - required:
                  - replica_set
                properties:
                  container:
                    nullable: true
                    type: string
                  cron_job:
                    type: string
                  deployment:
                    description: <!--${internal}--> Deployment to mirror.
                    type: string
                  job:
                    type: string
                  pod:
                    description: <!--${internal}--> Pod to mirror.
                    type: string
                  replica_set:
                    type: string
                  rollout:
                    description: <!--${internal}--> Rollout to mirror.
                    type: string
                  service:
                    type: string
                  stateful_set:
                    type: string
                type: object
              ttlSecs:
                description: The duration in seconds this branch database will live idling.
                format: uint64
                minimum: 0.0
                type: integer
            required:
            - connectionSource
            - id
            - target
            - ttlSecs
            type: object
          status:
            nullable: true
            properties:
              expireTime:
                description: Time when the branch database should be deleted.
                format: date-time
                type: string
              phase:
                enum:
                - Pending
                - Ready
                type: string
              sessionInfo:
                additionalProperties:
                  properties:
                    id:
                      description: Session id.
                      type: string
                    owner:
                      description: Owner info of the session.
                      properties:
                        hostname:
                          description: Creator hostname.
                          type: string
                        k8sUsername:
                          description: Creator Kubernetes username.
                          type: string
                        userId:
                          description: Unique ID.
                          type: string
                        username:
                          description: Creator local username.
                          type: string
                      required:
                      - hostname
                      - k8sUsername
                      - userId
                      - username
                      type: object
                  required:
                  - id
                  - owner
                  type: object
                default: {}
                description: Information of sessions that are using this branch database.
                type: object
            required:
            - expireTime
            - phase
            type: object
        required:
        - spec
        title: MongodbBranchDatabase
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{ end }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclusterworkloadpatches.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordClusterWorkloadPatch
    plural: mirrordclusterworkloadpatches
    singular: mirrordclusterworkloadpatch
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: API version of the workload.
      jsonPath: .spec.workloadRef.apiVersion
      name: WORKLOAD-API-VERSION
      type: string
    - description: Kind of the workload.
      jsonPath: .spec.workloadRef.kind
      name: WORKLOAD-KIND
      type: string
    - description: Name of the workload.
      jsonPath: .spec.workloadRef.name
      name: WORKLOAD-NAME
      type: string
    - description: Namespace of the workload.
      jsonPath: .spec.workloadRef.namespace
      name: WORKLOAD-NAMESPACE
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterWorkloadPatchSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Internal resource, representing operator patch state of some workload.

              This is an aggregated state of accepted [`MirrordClusterWorkloadPatchRequest`]s.
            properties:
              requests:
                description: |-
                  Collection of accepted [`MirrordClusterWorkloadPatchRequest`]s.

                  These requests will be enforced on the workload.
                items:
                  description: An accepted [`MirrordClusterWorkloadPatchRequest`], part of [`MirrordClusterWorkloadPatch`].
                  properties:
                    envVars:
                      description: Environment variables to be set in the pod template.
                      items:
                        properties:
                          container:
                            type: string
                          value:
                            type: string
                          variable:
                            type: string
                        required:
                        - container
                        - value
                        - variable
                        type: object
                      type: array
                    replicas:
                      description: |-
                        Number of replicas to be set in the workload spec.

                        [`None`] means that replicas should not be patched.
                      format: int32
                      nullable: true
                      type: integer
                    uid:
                      description: UID of the origin [`MirrordClusterWorkloadPatchRequest`] resource.
                      type: string
                  required:
                  - envVars
                  - uid
                  type: object
                type: array
              workloadRef:
                description: Reference to the workload being patched.
                properties:
                  apiVersion:
                    type: string
                  kind:
                    type: string
                  name:
                    type: string
                  namespace:
                    type: string
                required:
                - apiVersion
                - kind
                - name
                - namespace
                type: object
            required:
            - requests
            - workloadRef
            type: object
        required:
        - spec
        title: MirrordClusterWorkloadPatch
        type: object
    served: true
    storage: true
    subresources: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclusterworkloadpatchrequests.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordClusterWorkloadPatchRequest
    plural: mirrordclusterworkloadpatchrequests
    singular: mirrordclusterworkloadpatchrequest
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: API version of the workload.
      jsonPath: .spec.workloadRef.apiVersion
      name: WORKLOAD-API-VERSION
      type: string
    - description: Kind of the workload.
      jsonPath: .spec.workloadRef.kind
      name: WORKLOAD-KIND
      type: string
    - description: Name of the workload.
      jsonPath: .spec.workloadRef.name
      name: WORKLOAD-NAME
      type: string
    - description: Namespace of the workload.
      jsonPath: .spec.workloadRef.namespace
      name: WORKLOAD-NAMESPACE
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterWorkloadPatchRequestSpec via `CustomResource`
        properties:
          spec:
            description: Internal resource, representing an operator request to patch some workload.
            properties:
              envVars:
                description: Environment variables to be set in the pod template.
                items:
                  properties:
                    container:
                      type: string
                    value:
                      type: string
                    variable:
                      type: string
                  required:
                  - container
                  - value
                  - variable
                  type: object
                type: array
              replicas:
                description: |-
                  Number of replicas to be set in the workload spec.

                  [`None`] means that replicas should not be patched.
                format: int32
                nullable: true
                type: integer
              workloadRef:
                description: Reference to the workload being patched.
                properties:
                  apiVersion:
                    type: string
                  kind:
                    type: string
                  name:
                    type: string
                  namespace:
                    type: string
                required:
                - apiVersion
                - kind
                - name
                - namespace
                type: object
            required:
            - envVars
            - workloadRef
            type: object
          status:
            nullable: true
            properties:
              accepted:
                type: boolean
            required:
            - accepted
            type: object
        required:
        - spec
        title: MirrordClusterWorkloadPatchRequest
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclustersessions.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordClusterSession
    plural: mirrordclustersessions
    singular: mirrordclustersession
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: User unique ID..
      jsonPath: .spec.owner.userId
      name: USER ID
      type: string
    - description: User local POSIX name.
      jsonPath: .spec.owner.username
      name: USERNAME
      type: string
    - description: User hostname.
      jsonPath: .spec.owner.hostname
      name: HOSTNAME
      type: string
    - description: User Kubernetes name.
      jsonPath: .spec.owner.k8sUsername
      name: K8S USER
      type: string
    - description: Namespace of the session.
      jsonPath: .spec.namespace
      name: NAMESPACE
      type: string
    - description: Target of the session.
      jsonPath: .spec.target
      name: TARGET
      type: string
    - description: Time when the session was started.
      jsonPath: .metadata.creationTimestamp
      name: STARTED AT
      type: date
    - description: Time when the session was closed.
      jsonPath: .metadata.deletionTimestamp
      name: CLOSED AT
      type: date
    - description: Reason for which the session was closed.
      jsonPath: .status.closed.reason
      name: CLOSE REASON
      type: string
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterSessionSpec via `CustomResource`
        properties:
          spec:
            properties:
              ciInfo:
                description: CI info when a session is started with `mirrord ci start`.
                nullable: true
                properties:
                  environment:
                    description: Staging, production, test, nightly, ...
                    nullable: true
                    type: string
                  pipeline:
                    description: Pipeline/job name, e.g. "e2e-tests".
                    nullable: true
                    type: string
                  provider:
                    description: CI provider, e.g. "github", "gitlab", ...
                    nullable: true
                    type: string
                  triggeredBy:
                    description: PR, manual, push, ...
                    nullable: true
                    type: string
                type: object
              copyTarget:
                description: |-
                  Copy target configuration for this session.

                  Set when the session uses a copied pod.
                nullable: true
                properties:
                  scaledown:
                    description: Whether the original target should be scaled down.
                    type: boolean
                required:
                - scaledown
                type: object
              jiraMetrics:
                description: Resources needed to report session metrics to the mirrord Jira app.
                nullable: true
                properties:
                  branchName:
                    description: The user's current git branch.
                    type: string
                required:
                - branchName
                type: object
              namespace:
                description: Kubernetes namespace of the session.
                type: string
              owner:
                description: Owner of this session
                properties:
                  hostname:
                    description: Hostname of the machine where the CLI command was executed.
                    type: string
                  k8sUsername:
                    description: Name of the Kubernetes user who's identity was assumed by the CLI.
                    type: string
                  userId:
                    description: Unique ID.
                    type: string
                  username:
                    description: Name of the POSIX user that executed the CLI command.
                    type: string
                required:
                - hostname
                - k8sUsername
                - userId
                - username
                type: object
              target:
                description: |-
                  Target of the session.

                  None for targetless sessions.
                nullable: true
                properties:
                  apiVersion:
                    description: Kubernetes resource apiVersion.
                    type: string
                  container:
                    description: Name of the container defined in the Pod spec.
                    type: string
                  kind:
                    description: Kubernetes resource kind.
                    type: string
                  name:
                    description: Kubernetes resource name.
                    type: string
                required:
                - apiVersion
                - container
                - kind
                - name
                type: object
              multiClusterParentName:
                description: Name of the parent MirrordMultiClusterSession. When set, this is a child session created by the Primary operator as part of a multi-cluster session.
                type: string
            required:
            - namespace
            - owner
            type: object
          status:
            description: Status of a mirrord session.
            nullable: true
            properties:
              closed:
                description: If the session has been closed, describes the reason.
                nullable: true
                properties:
                  message:
                    description: Optional human friendly message.
                    nullable: true
                    type: string
                  reason:
                    description: Short reason in PascalCase.
                    type: string
                required:
                - reason
                type: object
              connectedTimestamp:
                description: Last time when the session was observed to have an open user connection.
                format: date-time
                nullable: true
                type: string
              copyTarget:
                description: Copy target status for sessions using a copied pod.
                nullable: true
                properties:
                  copiedPodStatus:
                    description: |-
                      Status of the produced copied pod.

                      `None` if there is no valid pod at the moment.
                    nullable: true
                    properties:
                      name:
                        description: Name of the copied pod.
                        type: string
                      namespace:
                        description: Namespace of the copied pod.
                        type: string
                      targetContainer:
                        description: Name of the target container in the copied pod.
                        type: string
                    required:
                    - name
                    - namespace
                    - targetContainer
                    type: object
                  name:
                    description: Name of the CopyTargetCrd, used by CLI when making connections.
                    type: string
                required:
                - name
                type: object
            type: object
        required:
        - spec
        title: MirrordClusterSession
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: mirrordclusterexternalresources.mirrord.metalbear.co
spec:
  group: mirrord.metalbear.co
  names:
    kind: MirrordClusterExternalResource
    plural: mirrordclusterexternalresources
    singular: mirrordclusterexternalresource
  scope: Cluster
  versions:
  - name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for MirrordClusterExternalResourceSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Generic external resource created by the operator.

              For future compatibility and to avoid any schema issues, every resource type is represented in a separate optional field.
            properties:
              sqsQueue:
                description: Temporary SQS queue created for queue splitting.
                nullable: true
                properties:
                  nameOrUrl:
                    type: string
                required:
                - nameOrUrl
                type: object
            type: object
        required:
        - spec
        title: MirrordClusterExternalResource
        type: object
    served: true
    storage: true
    subresources: {}
{{- if .Values.operator.previewEnv }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: previewsessions.preview.mirrord.metalbear.co
spec:
  group: preview.mirrord.metalbear.co
  names:
    categories: []
    kind: PreviewSession
    plural: previewsessions
    shortNames: []
    singular: previewsession
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1alpha
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for PreviewSessionSpec via `CustomResource`
        properties:
          spec:
            description: This resource represents a preview environment created by the `mirrord preview start` command.
            properties:
              image:
                description: User's container image to run in the preview pod.
                type: string
              incoming:
                description: |-
                  Incoming traffic configuration for the preview environment.

                  Specifies which ports to steal/mirror traffic from and optional HTTP filters. This configuration is extracted from the user's mirrord config. When `None`, incoming traffic is not intercepted.
                nullable: true
                properties:
                  httpFilter:
                    description: JSON-serialized `HttpFilterConfig`. Stored as an opaque string to avoid coupling the CRD schema to `HttpFilterConfig`, which is too large to manually duplicate here and could break backwards compatibility if stored directly.
                    nullable: true
                    type: string
                  ports:
                    description: Explicit list of ports to steal/mirror. When `None`, the operator discovers ports from the preview pod's container port declarations.
                    items:
                      format: uint16
                      minimum: 0.0
                      type: integer
                    nullable: true
                    type: array
                  steal:
                    description: Whether to steal (`true`) or mirror (`false`) traffic from the target.
                    type: boolean
                required:
                - steal
                type: object
              key:
                description: Environment key used to group related preview pods and for traffic filtering.
                type: string
              target:
                description: Target to copy pod configuration from (deployment, pod, statefulset, etc.). The preview pod will be a copy of the target's pod spec with the user's image.
                properties:
                  apiVersion:
                    description: Kubernetes resource apiVersion.
                    type: string
                  container:
                    description: Name of the container defined in the Pod spec.
                    type: string
                  kind:
                    description: Kubernetes resource kind.
                    type: string
                  name:
                    description: Kubernetes resource name.
                    type: string
                required:
                - apiVersion
                - container
                - kind
                - name
                type: object
              ttlSecs:
                description: How long (in seconds) this session is allowed to live. The operator will terminate the session when this time elapses.
                format: uint64
                minimum: 0.0
                type: integer
            required:
            - image
            - key
            - target
            - ttlSecs
            type: object
          status:
            description: Status of a preview session resource.
            nullable: true
            properties:
              expiresAt:
                description: |-
                  Timestamp when the session's TTL expires.

                  Set when the session enters the `Ready` phase. Computed as `now + ttl_secs` at the moment the operator starts the TTL countdown. `None` during earlier phases or when running against an older operator that does not set this field.
                format: date-time
                nullable: true
                type: string
              failureMessage:
                description: |-
                  Human-readable description of why the session failed.

                  Only set when `phase` is `Failed`.
                nullable: true
                type: string
              phase:
                description: Current lifecycle phase of the session.
                enum:
                - Initializing
                - Waiting
                - Ready
                - Failed
                - Unknown
                type: string
              podName:
                description: |-
                  Name of the preview pod created for this session.

                  Set once the pod is created (from the `Waiting` phase onward). `None` during `Initializing` or if pod creation failed before a name was assigned.
                nullable: true
                type: string
              startedAt:
                description: Timestamp of when the operator started processing this session.
                format: date-time
                type: string
            required:
            - phase
            - startedAt
            type: object
        required:
        - spec
        title: PreviewSession
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{- end }}
